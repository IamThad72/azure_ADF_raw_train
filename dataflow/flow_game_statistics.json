{
	"name": "flow_game_statistics",
	"properties": {
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "dataset_3S_NFL_Raw_Game_Statistics",
						"type": "DatasetReference"
					},
					"name": "sourceGameStatistics"
				},
				{
					"dataset": {
						"referenceName": "dataset_3s_NFL_Raw_League_HIerarchy",
						"type": "DatasetReference"
					},
					"name": "sourceLeagueHierarchy"
				}
			],
			"sinks": [],
			"transformations": [
				{
					"name": "selectStatsNode"
				},
				{
					"name": "flatten1"
				},
				{
					"name": "filter1"
				},
				{
					"name": "flatten2"
				},
				{
					"name": "filter2"
				},
				{
					"name": "derivedColumn1"
				},
				{
					"name": "derivedColumn2"
				},
				{
					"name": "join1"
				},
				{
					"name": "select1"
				},
				{
					"name": "select2"
				},
				{
					"name": "flatten3"
				},
				{
					"name": "flatten4"
				},
				{
					"name": "flatten5"
				},
				{
					"name": "join2"
				}
			],
			"scriptLines": [
				"source(output(",
				"          status as string,",
				"          scheduled as string,",
				"          attendance as integer,",
				"          utc_offset as integer,",
				"          entry_mode as string,",
				"          clock as string,",
				"          quarter as integer,",
				"          summary as (season as (id as string, year as integer, type as string, name as string), week as (id as string, sequence as integer, title as string), venue as (id as string, name as string, city as string, state as string, zip as string, address as string, capacity as integer, surface as string, roof_type as string, sr_id as string, country as string, location as (lat as string, lng as string)), home as (id as string, name as string, market as string, alias as string, sr_id as string, used_timeouts as integer, remaining_timeouts as integer, points as integer), away as (id as string, name as string, market as string, alias as string, sr_id as string, used_timeouts as integer, remaining_timeouts as integer, points as integer)),",
				"          statistics as (home as (id as string, name as string, market as string, alias as string, sr_id as string, summary as (possession_time as string, avg_gain as double, safeties as integer, turnovers as integer, play_count as integer, rush_plays as integer, total_yards as integer, fumbles as integer, lost_fumbles as integer, penalties as integer, penalty_yards as integer, return_yards as integer), rushing as (totals as (avg_yards as double, attempts as integer, touchdowns as integer, tlost as integer, tlost_yards as integer, yards as integer, longest as integer, longest_touchdown as integer, redzone_attempts as integer), players as (id as string, name as string, jersey as string, position as string, avg_yards as integer, attempts as integer, touchdowns as integer, yards as integer, longest as integer, longest_touchdown as integer, redzone_attempts as integer)[]), receiving as (totals as (targets as integer, receptions as integer, avg_yards as double, yards as integer, touchdowns as integer, yards_after_catch as integer, longest as integer, longest_touchdown as integer, redzone_targets as integer, air_yards as integer), players as (id as string, name as string, jersey as string, position as string, receptions as integer, targets as integer, yards as integer, avg_yards as integer, longest as integer, touchdowns as integer, longest_touchdown as integer, yards_after_catch as integer, redzone_targets as integer, air_yards as integer)[]), punts as (totals as (attempts as integer, yards as integer, net_yards as integer, blocked as integer, touchbacks as integer, inside_20 as integer, return_yards as integer, avg_net_yards as double, avg_yards as double, longest as integer), players as (id as string, name as string, jersey as string, position as string, attempts as integer, yards as integer, avg_yards as double, blocked as integer, longest as integer, touchbacks as integer, inside_20 as integer, avg_net_yards as double, return_yards as integer, net_yards as integer)[]), punt_returns as (totals as (avg_yards as double, yards as integer, longest as integer, touchdowns as integer, longest_touchdown as integer, faircatches as integer, number as integer), players as (id as string, name as string, jersey as string, position as string, yards as integer, avg_yards as integer, touchdowns as integer, longest as integer, faircatches as integer, longest_touchdown as integer, number as integer)[]), penalties as (totals as (penalties as integer, yards as integer), players as (id as string, name as string, jersey as string, position as string, penalties as integer, yards as integer)[]), passing as (totals as (attempts as integer, completions as integer, cmp_pct as double, interceptions as integer, sack_yards as integer, rating as double, touchdowns as integer, avg_yards as double, sacks as integer, longest as integer, longest_touchdown as integer, air_yards as integer, redzone_attempts as integer, net_yards as integer, yards as integer), players as (id as string, name as string, jersey as string, position as string, attempts as integer, completions as integer, cmp_pct as integer, yards as integer, avg_yards as integer, sacks as integer, sack_yards as integer, touchdowns as integer, longest as integer, interceptions as integer, rating as double, longest_touchdown as integer, air_yards as integer, redzone_attempts as integer)[]), misc_returns as (totals as (yards as integer, touchdowns as integer, blk_fg_touchdowns as integer, blk_punt_touchdowns as integer, fg_return_touchdowns as integer, ez_rec_touchdowns as integer, number as integer, longest_touchdown as integer), players as string[]), kickoffs as (totals as (endzone as integer, inside_20 as integer, return_yards as integer, touchbacks as integer, yards as integer, out_of_bounds as integer, number as integer, total_endzone as integer, onside_attempts as integer, onside_successes as integer, squib_kicks as integer), players as (id as string, name as string, jersey as string, position as string, endzone as integer, inside_20 as integer, return_yards as integer, touchbacks as integer, yards as integer, out_of_bounds as integer, number as integer, total_endzone as integer)[]), kick_returns as (totals as (avg_yards as double, yards as integer, longest as integer, touchdowns as integer, longest_touchdown as integer, faircatches as integer, number as integer), players as (id as string, name as string, jersey as string, position as string, avg_yards as integer, yards as integer, longest as integer, touchdowns as integer, longest_touchdown as integer, faircatches as integer, number as integer)[]), int_returns as (totals as (avg_yards as double, yards as integer, touchdowns as integer, number as integer, longest as integer, longest_touchdown as integer), players as string[]), fumbles as (totals as (fumbles as integer, lost_fumbles as integer, own_rec as integer, own_rec_yards as integer, opp_rec as integer, opp_rec_yards as integer, out_of_bounds as integer, forced_fumbles as integer, own_rec_tds as integer, opp_rec_tds as integer, ez_rec_tds as integer), players as (id as string, name as string, jersey as string, position as string, fumbles as integer, lost_fumbles as integer, own_rec as integer, own_rec_yards as integer, opp_rec as integer, opp_rec_yards as integer, out_of_bounds as integer, forced_fumbles as integer, own_rec_tds as integer, opp_rec_tds as integer, ez_rec_tds as integer)[]), field_goals as (totals as (attempts as integer, made as integer, blocked as integer, yards as integer, avg_yards as double, longest as integer, net_attempts as integer, pct as integer), players as (id as string, name as string, jersey as string, position as string, attempts as integer, made as integer, blocked as integer, yards as integer, avg_yards as integer, longest as integer, pct as integer)[]), defense as (totals as (tackles as integer, assists as integer, combined as integer, sacks as integer, sack_yards as integer, interceptions as integer, passes_defended as integer, forced_fumbles as integer, fumble_recoveries as integer, qb_hits as integer, tloss as integer, tloss_yards as integer, safeties as integer, sp_tackles as integer, sp_assists as integer, sp_forced_fumbles as integer, sp_fumble_recoveries as integer, sp_blocks as integer, misc_tackles as integer, misc_assists as integer, misc_forced_fumbles as integer, misc_fumble_recoveries as integer), players as (id as string, name as string, jersey as string, position as string, tackles as integer, assists as integer, combined as integer, sacks as integer, sack_yards as integer, interceptions as integer, passes_defended as integer, forced_fumbles as integer, fumble_recoveries as integer, qb_hits as integer, tloss as integer, tloss_yards as integer, safeties as integer, sp_tackles as integer, sp_assists as integer, sp_forced_fumbles as integer, sp_fumble_recoveries as integer, sp_blocks as integer, misc_tackles as integer, misc_assists as integer, misc_forced_fumbles as integer, misc_fumble_recoveries as integer)[]), extra_points as (kicks as (totals as (attempts as integer, blocked as integer, made as integer, pct as integer), players as string[]), conversions as (totals as (pass_attempts as integer, pass_successes as integer, rush_attempts as integer, rush_successes as integer, defense_attempts as integer, defense_successes as integer, turnover_successes as integer), players as string[])), first_downs as (pass as integer, penalty as integer, rush as integer, total as integer), interceptions as (return_yards as integer, returned as integer, number as integer), touchdowns as (pass as integer, rush as integer, total_return as integer, total as integer, fumble_return as integer, int_return as integer, kick_return as integer, punt_return as integer, other as integer), efficiency as (goaltogo as (attempts as integer, successes as integer, pct as double), redzone as (attempts as integer, successes as integer, pct as double), thirddown as (attempts as integer, successes as integer, pct as double), fourthdown as (attempts as integer, successes as integer, pct as integer))), away as (id as string, name as string, market as string, alias as string, sr_id as string, summary as (possession_time as string, avg_gain as double, safeties as integer, turnovers as integer, play_count as integer, rush_plays as integer, total_yards as integer, fumbles as integer, lost_fumbles as integer, penalties as integer, penalty_yards as integer, return_yards as integer), rushing as (totals as (avg_yards as double, attempts as integer, touchdowns as integer, tlost as integer, tlost_yards as integer, yards as integer, longest as integer, longest_touchdown as integer, redzone_attempts as integer), players as (id as string, name as string, jersey as string, position as string, avg_yards as integer, attempts as integer, touchdowns as integer, yards as integer, longest as integer, longest_touchdown as integer, redzone_attempts as integer)[]), receiving as (totals as (targets as integer, receptions as integer, avg_yards as double, yards as integer, touchdowns as integer, yards_after_catch as integer, longest as integer, longest_touchdown as integer, redzone_targets as integer, air_yards as integer), players as (id as string, name as string, jersey as string, position as string, receptions as integer, targets as integer, yards as integer, avg_yards as double, longest as integer, touchdowns as integer, longest_touchdown as integer, yards_after_catch as integer, redzone_targets as integer, air_yards as integer)[]), punts as (totals as (attempts as integer, yards as integer, net_yards as integer, blocked as integer, touchbacks as integer, inside_20 as integer, return_yards as integer, avg_net_yards as double, avg_yards as double, longest as integer), players as (id as string, name as string, jersey as string, position as string, attempts as integer, yards as integer, avg_yards as double, blocked as integer, longest as integer, touchbacks as integer, inside_20 as integer, avg_net_yards as double, return_yards as integer, net_yards as integer)[]), punt_returns as (totals as (avg_yards as double, yards as integer, longest as integer, touchdowns as integer, longest_touchdown as integer, faircatches as integer, number as integer), players as (id as string, name as string, jersey as string, position as string, yards as integer, avg_yards as integer, touchdowns as integer, longest as integer, faircatches as integer, longest_touchdown as integer, number as integer)[]), penalties as (totals as (penalties as integer, yards as integer), players as (id as string, name as string, jersey as string, position as string, penalties as integer, yards as integer)[]), passing as (totals as (attempts as integer, completions as integer, cmp_pct as double, interceptions as integer, sack_yards as integer, rating as double, touchdowns as integer, avg_yards as double, sacks as integer, longest as integer, longest_touchdown as integer, air_yards as integer, redzone_attempts as integer, net_yards as integer, yards as integer), players as (id as string, name as string, jersey as string, position as string, attempts as integer, completions as integer, cmp_pct as double, yards as integer, avg_yards as double, sacks as integer, sack_yards as integer, touchdowns as integer, longest as integer, interceptions as integer, rating as double, longest_touchdown as integer, air_yards as integer, redzone_attempts as integer)[]), misc_returns as (totals as (yards as integer, touchdowns as integer, blk_fg_touchdowns as integer, blk_punt_touchdowns as integer, fg_return_touchdowns as integer, ez_rec_touchdowns as integer, number as integer), players as string[]), kickoffs as (totals as (endzone as integer, inside_20 as integer, return_yards as integer, touchbacks as integer, yards as integer, out_of_bounds as integer, number as integer, total_endzone as integer, onside_attempts as integer, onside_successes as integer, squib_kicks as integer), players as (id as string, name as string, jersey as string, position as string, endzone as integer, inside_20 as integer, return_yards as integer, touchbacks as integer, yards as integer, out_of_bounds as integer, number as integer, total_endzone as integer)[]), kick_returns as (totals as (avg_yards as double, yards as integer, longest as integer, touchdowns as integer, longest_touchdown as integer, faircatches as integer, number as integer), players as (id as string, name as string, jersey as string, position as string, avg_yards as integer, yards as integer, longest as integer, touchdowns as integer, longest_touchdown as integer, faircatches as integer, number as integer)[]), int_returns as (totals as (avg_yards as double, yards as integer, touchdowns as integer, number as integer, longest as integer, longest_touchdown as integer), players as string[]), fumbles as (totals as (fumbles as integer, lost_fumbles as integer, own_rec as integer, own_rec_yards as integer, opp_rec as integer, opp_rec_yards as integer, out_of_bounds as integer, forced_fumbles as integer, own_rec_tds as integer, opp_rec_tds as integer, ez_rec_tds as integer), players as (id as string, name as string, jersey as string, position as string, fumbles as integer, lost_fumbles as integer, own_rec as integer, own_rec_yards as integer, opp_rec as integer, opp_rec_yards as integer, out_of_bounds as integer, forced_fumbles as integer, own_rec_tds as integer, opp_rec_tds as integer, ez_rec_tds as integer)[]), field_goals as (totals as (attempts as integer, made as integer, blocked as integer, yards as integer, avg_yards as double, longest as integer, net_attempts as integer, pct as integer), players as (id as string, name as string, jersey as string, position as string, attempts as integer, made as integer, blocked as integer, yards as integer, avg_yards as double, longest as integer, pct as integer)[]), defense as (totals as (tackles as integer, assists as integer, combined as integer, sacks as integer, sack_yards as integer, interceptions as integer, passes_defended as integer, forced_fumbles as integer, fumble_recoveries as integer, qb_hits as integer, tloss as integer, tloss_yards as integer, safeties as integer, sp_tackles as integer, sp_assists as integer, sp_forced_fumbles as integer, sp_fumble_recoveries as integer, sp_blocks as integer, misc_tackles as integer, misc_assists as integer, misc_forced_fumbles as integer, misc_fumble_recoveries as integer, def_targets as integer, def_comps as integer, blitzes as integer, hurries as integer, knockdowns as integer, missed_tackles as integer), players as (id as string, name as string, jersey as string, position as string, tackles as integer, assists as integer, combined as integer, sacks as integer, sack_yards as integer, interceptions as integer, passes_defended as integer, forced_fumbles as integer, fumble_recoveries as integer, qb_hits as integer, tloss as integer, tloss_yards as integer, safeties as integer, sp_tackles as integer, sp_assists as integer, sp_forced_fumbles as integer, sp_fumble_recoveries as integer, sp_blocks as integer, misc_tackles as integer, misc_assists as integer, misc_forced_fumbles as integer, misc_fumble_recoveries as integer)[]), extra_points as (kicks as (totals as (attempts as integer, blocked as integer, made as integer, pct as integer), players as (id as string, name as string, jersey as string, position as string, attempts as integer, blocked as integer, made as integer, pct as integer)[]), conversions as (totals as (pass_attempts as integer, pass_successes as integer, rush_attempts as integer, rush_successes as integer, defense_attempts as integer, defense_successes as integer, turnover_successes as integer), players as string[])), first_downs as (pass as integer, penalty as integer, rush as integer, total as integer), interceptions as (return_yards as integer, returned as integer, number as integer), touchdowns as (pass as integer, rush as integer, total_return as integer, total as integer, fumble_return as integer, int_return as integer, kick_return as integer, punt_return as integer, other as integer), efficiency as (goaltogo as (attempts as integer, successes as integer, pct as double), redzone as (attempts as integer, successes as integer, pct as double), thirddown as (attempts as integer, successes as integer, pct as double), fourthdown as (attempts as integer, successes as integer, pct as integer)))),",
				"          {_comment} as string",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     format: 'document',",
				"     systemColumns: true) ~> sourceGameStatistics",
				"source(output(",
				"          league as (id as string, name as string, alias as string),",
				"          conferences as (id as string, name as string, alias as string, divisions as (id as string, name as string, alias as string, teams as (id as string, name as string, market as string, alias as string, sr_id as string, founded as integer, owner as string, general_manager as string, president as string, mascot as string, championships_won as integer, championship_seasons as string, conference_titles as integer, division_titles as integer, playoff_appearances as integer, venue as (id as string, start_date as string, end_date as string, name as string, city as string, state as string, country as string, zip as string, address as string, capacity as integer, surface as string, roof_type as string, sr_id as string, location as (lat as string, lng as string))[], franchise as (id as string, name as string, alias as string), team_colors as (type as string, hex_color as string, alpha as integer, rgb_color as (red as integer, green as integer, blue as integer))[])[])[])[],",
				"          {_comment} as string",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     format: 'document') ~> sourceLeagueHierarchy",
				"sourceGameStatistics select(mapColumn(",
				"          scheduled,",
				"          utc_offset,",
				"          statistics,",
				"          game_id = id,",
				"          venue_id = summary.venue.id",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> selectStatsNode",
				"selectStatsNode foldDown(unroll(statistics.home.rushing.players),",
				"     mapColumn(",
				"          scheduled,",
				"          utc_offset,",
				"          game_id,",
				"          venue_id,",
				"          player_id = statistics.home.rushing.players.id,",
				"          player_name = statistics.home.rushing.players.name,",
				"          position = statistics.home.rushing.players.position,",
				"          rs_attempts = statistics.home.rushing.players.attempts,",
				"          rs_yards = statistics.home.rushing.players.yards,",
				"          rs_avg_yards = statistics.home.rushing.players.avg_yards",
				"     ),",
				"     skipDuplicateMapInputs: false,",
				"     skipDuplicateMapOutputs: false) ~> flatten1",
				"flatten1 filter(position == 'RB') ~> filter1",
				"selectStatsNode foldDown(unroll(statistics.home.receiving.players),",
				"     mapColumn(",
				"          scheduled,",
				"          utc_offset,",
				"          game_id,",
				"          venue_id,",
				"          player_id = statistics.home.receiving.players.id,",
				"          player_name = statistics.home.receiving.players.name,",
				"          position = statistics.home.receiving.players.position,",
				"          targets = statistics.home.receiving.players.targets,",
				"          receptions = statistics.home.receiving.players.receptions,",
				"          yards = statistics.home.receiving.players.yards,",
				"          yards_after_catch = statistics.home.receiving.players.yards_after_catch",
				"     ),",
				"     skipDuplicateMapInputs: false,",
				"     skipDuplicateMapOutputs: false) ~> flatten2",
				"flatten2 filter(position == 'RB') ~> filter2",
				"filter2 derive(gameplayerID = concat(game_id, player_id)) ~> derivedColumn1",
				"filter1 derive(gameplayerID = concat(game_id, player_id)) ~> derivedColumn2",
				"derivedColumn2, derivedColumn1 join(derivedColumn2@gameplayerID == derivedColumn1@gameplayerID,",
				"     joinType:'inner',",
				"     matchType:'exact',",
				"     ignoreSpaces: false,",
				"     broadcast: 'auto')~> join1",
				"join1 select(mapColumn(",
				"          gameplayerID = derivedColumn2@gameplayerID,",
				"          scheduled = flatten1@scheduled,",
				"          utc_offset = flatten1@utc_offset,",
				"          game_id = flatten1@game_id,",
				"          venue_id = flatten1@venue_id,",
				"          player_id = flatten1@player_id,",
				"          player_name = flatten1@player_name,",
				"          position = flatten1@position,",
				"          rs_attempts,",
				"          rs_yards,",
				"          rs_avg_yards,",
				"          targets,",
				"          receptions,",
				"          rc_yards = yards",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> select1",
				"sourceLeagueHierarchy select(mapColumn(",
				"          league,",
				"          conferences",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> select2",
				"select2 foldDown(unroll(conferences, conferences),",
				"     mapColumn(",
				"          divisions = conferences.divisions",
				"     ),",
				"     skipDuplicateMapInputs: false,",
				"     skipDuplicateMapOutputs: false) ~> flatten3",
				"flatten3 foldDown(unroll(divisions.teams),",
				"     mapColumn(",
				"          venue = divisions.teams.venue",
				"     ),",
				"     skipDuplicateMapInputs: false,",
				"     skipDuplicateMapOutputs: false) ~> flatten4",
				"flatten4 foldDown(unroll(venue),",
				"     mapColumn(",
				"          venue_id = venue.id,",
				"          name = venue.name,",
				"          lat = venue.location.lat,",
				"          lng = venue.location.lng",
				"     ),",
				"     skipDuplicateMapInputs: false,",
				"     skipDuplicateMapOutputs: false) ~> flatten5",
				"select1, flatten5 join(select1@venue_id == flatten5@venue_id,",
				"     joinType:'inner',",
				"     matchType:'exact',",
				"     ignoreSpaces: false,",
				"     broadcast: 'auto')~> join2"
			]
		}
	}
}